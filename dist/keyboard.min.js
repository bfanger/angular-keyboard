angular.module("keyboard.focus",[]),angular.module("keyboard",["keyboard.focus"]),angular.module("keyboard").constant("undefined"),angular.module("keyboard").factory("KbContainerController",["undefined","$log",function(e,t){"use strict";function i(t){this.identifier="[kb-container]",this.ngModel=e,this.selected=[],this.multiple=!1,this.cyclic=!1,this.active=e,this._element=t[0]}return i.$inject=["$element"],angular.extend(i.prototype,{initialize:function(e){this.multiple=angular.isDefined(e.attrs.multiple),this.cyclic=angular.isDefined(e.attrs.kbCyclic),angular.extend(this,e),this.ngModel.$render=function(){this.multiple?(this.selected=this.ngModel.$viewValue,angular.isArray(this.selected)===!1&&(angular.isDefined(this.selected)&&t.error(this.identifier,"ng-model(multiple) must be an array, got:",this.selected),this.selected=[])):this.selected[0]=this.ngModel.$viewValue;for(var e in this.selected){var i=this._locate(this.selected[e]);if(i){this.active=i;break}}}.bind(this)},select:function(e){this.multiple?this.isSelected(e)===!1&&(this.selected.push(e),this.ngModel.$setViewValue(this.selected)):(this.selected[0]=e,this.ngModel.$setViewValue(e))},deselect:function(e){var t=this.selected.indexOf(e);-1!==t&&this.selected.splice(t,1)},toggle:function(e){this.isSelected(e)?this.deselect(e):this.select(e)},isSelected:function(e){return-1!==this.selected.indexOf(e)},previous:function(){var e=this._getSiblingItems(this.active).previous;return e?(this.active=e,!0):!1},next:function(){var e=this._getSiblingItems(this.active).next;return e?(this.active=e,!0):!1},activate:function(){return t.$error(this.identifier,"activate() is not implemented"),!1},invoke:function(){return t.$error(this.identifier,"invoke() is not implemented"),!1},_locate:function(e){for(var t=this._element.querySelectorAll("[kb-item]"),i=0;i<t.length;i++){var n=angular.element(t.item(i)).controller("kbItem");if(n.model===e)return n}},_getSiblingItems:function(e){for(var t=e.element[0],i=this._element.querySelectorAll("[kb-item]"),n=0;n<i.length;n++){var o=i.item(n);if(o===t){var r={};return 0!==n&&(r.previous=angular.element(i.item(n-1)).controller("kbItem")),n<i.length-1&&(r.next=angular.element(i.item(n+1)).controller("kbItem")),r}}return{}},_first:function(){var e=this._element.querySelector("[kb-item]");return e?angular.element(e).controller("kbItem"):void 0},_last:function(){var e=this._element.querySelectorAll("[kb-item]");return e.length?angular.element(e[e.length-1]).controller("kbItem"):void 0}}),i}]),angular.module("keyboard").factory("KbItemController",["kbScroll","undefined",function(e,t){"use strict";return function(e){this.model=t,this.element=e}}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(){"use strict";return function(e,t,i){e.$watch(i.kbAutofocus,function(e){t.prop("autofocus",!!e)})}}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(e,t){"use strict";return function(i,n,o){i.$watch(e.get,function(e){e===o.kbFocus&&(""===e?t.error("[kb-focus] Invalid label in",n[0]):n[0].focus())}),n.on("focus",function(){e(o.kbFocus),i.$root.$$phase||i.$apply()}),n.on("blur",function(){e.get()===o.kbFocus&&(e.reset(),i.$root.$$phase||i.$apply())})}}]),angular.module("keyboard").directive("kbItem",["KbItemController","$animate","$log",function(e,t,i){"use strict";return{controller:e,require:["kbItem","?^kbList","?^kbSelect"],link:function(e,n,o,r){function l(e,t,i){return"left"===e&&i.left<t.left?t.left-i.left:"up"===e&&i.top<t.top?t.top-i.top:"right"===e&&i.left>t.left?i.left-t.left:"down"===e&&i.top>t.top?i.top-t.top:0}for(var c=r[0],a=r[1],s=n[0].tagName,u=1;u<r.length;u++)r[u]&&(a=r[u]);if(!a)return void i.error("Controller 'kbList' or 'kbSelect', required by directive 'kbItem', can't be found!");var f=o.kbSelectedClass||"kb-selected",d=o.kbActiveClass||"kb-active";c.model=e.$eval(o.kbItem),e.$watch(o.kbItem,function(e){c.model=e}),"undefined"==typeof a.active?a.active=c:a.isSelected(c.model)&&a.isSelected(a.active.model)===!1&&(a.active=c),e.$watch(function(){return a.isSelected(c.model)},function(e){e?t.addClass(n,f):t.removeClass(n,f)}),e.$watch(function(){return a.active===c},function(e){e?(n.attr("tabindex",0),t.addClass(n,d)):(t.removeClass(n,d),"A"===s||"BUTTON"===s?n.attr("tabindex",0):n.removeAttr("tabindex"))});var h={37:"left",38:"up",39:"right",40:"down"};n.on("keydown",function(t){var i=!1;if(t.which>=37&&t.which<=40){var o=a._getSiblingItems(c),r=n[0].getBoundingClientRect();if(o.previous&&l(h[t.which],r,o.previous.element[0].getBoundingClientRect())&&(a.activate(o.previous),i=!0),o.next&&l(h[t.which],r,o.next.element[0].getBoundingClientRect())&&(a.activate(o.next),i=!0),!(i!==!1||o.next&&o.previous)){var s=t.which,u=!1;t.which<=38?s+=2:s-=2,o.next&&l(h[s],r,o.next.element[0].getBoundingClientRect())&&(a.cyclic?(a.activate(a._last()),i=!0):u="kbReachedBegin"),o.previous&&l(h[s],r,o.previous.element[0].getBoundingClientRect())&&(a.cyclic?(a.activate(a._first()),i=!0):u="kbReachedEnd"),u&&a.attrs[u]&&angular.element(a._element).scope().$eval(a.attrs[u],{$event:t})}}else(32===t.which||13===t.which)&&(i=a.invoke(c));i&&(t.preventDefault(),e.$apply())}),n.on("click",function(){a.activate(c),a.invoke(c),e.$apply()}),e.$on("$destroy",function(){a.active=a._first()})}}}]),angular.module("keyboard").directive("kbList",["KbContainerController","kbScroll",function(e,t){"use strict";return{controller:e,require:["kbList","ngModel"],link:function(e,i,n,o){var r=o[0];r.initialize({identifier:"[kb-list]",ngModel:o[1],attrs:n,activate:function(e){this.active=e,this.select(e.model),t.focus(e.element[0])},invoke:function(){return!1}})}}}]),angular.module("keyboard").directive("kbSelect",["KbContainerController","kbScroll",function(e,t){"use strict";return{controller:e,require:["kbSelect","ngModel"],link:function(e,i,n,o){var r=o[0];r.initialize({identifier:"[kb-select]",ngModel:o[1],attrs:n,activate:function(e){this.active=e,t.focus(e.element[0])},invoke:function(e){return this.toggle(e.model),!0}})}}}]),angular.module("keyboard.focus").factory("kbFocus",["$log",function(e){var t="",i=function(e){return 0===arguments.length?t:void i.set(e)};return i.get=function(){return t},i.set=function(i){"string"==typeof i?t=i:e.error("[kbFocus] label must be a string, got",i)},i.reset=function(){t=""},i}]),angular.module("keyboard").service("kbScroll",["$window",function(e){var t="BODY";navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(t="HTML");var i=this;this.change=function(e,t,i,n){if(n&&angular.element.prototype.animate){var o=angular.element(e),r={};return r[t]=i,o.animate(r,n),function(){o.stop(!0,!0)}}return e[t]=i,angular.noop},this.getScrollParent=function(e){for(var i=e.parentElement;i.nodeName!==t;){var n=getComputedStyle(i),o=n.overflow+n.overflowX+n.overflowY;if(o.match(/scroll|hidden/))break;i=i.parentElement}return i},this.to=function(n,o,r){var l=angular.noop,c=i.getScrollParent(n),a=n.getBoundingClientRect(),s={top:Math.ceil(a.top),right:Math.ceil(a.right),bottom:Math.ceil(a.bottom),left:Math.ceil(a.left)};if(c.nodeName===t)var u={top:0,right:e.innerWidth,bottom:e.innerHeight,left:0};else var f=c.getBoundingClientRect(),u={top:Math.ceil(f.top),right:Math.ceil(f.right),bottom:Math.ceil(f.bottom),left:Math.ceil(f.left)};var d=s.top-u.top,h=u.right-s.right,g=u.bottom-s.bottom,m=s.left-u.left;if(d+o.top<0?(l=i.change(c,"scrollTop",c.scrollTop+d+o.top,r),g+=d,d=0):g+o.bottom<0&&(l=i.change(c,"scrollTop",c.scrollTop-g+o.bottom,r),d+=g,g=0),m+o.left<0?(l=i.change(c,"scrollLeft",c.scrollLeft+m+o.left,r),h+=m,m=0):h+o.right<0&&(l=i.change(c,"scrollLeft",c.scrollLeft-h+o.right,r),m+=h,h=0),c.nodeName===t)return l;var v=i.to(c,{top:d,right:d,bottom:g,left:m},r);return function(){l(),v()}};var n=angular.noop;this.focus=function(e){n();var t=this.getScrollParent(e),i={top:t.scrollTop,left:t.scrollLeft};e.hasAttribute("tabindex")||e.setAttribute("tabindex",0),e.focus(),(t.scrollTop!==i.top||t.scrollLeft!==i.left)&&(t.scrollTop=i.top,t.scrollLeft=i.left,n=this.to(e,{top:0,right:0,bottom:0,left:0},200))}}]);
//# sourceMappingURL=keyboard.min.js.map